# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении
Данный раздел описывает типы данных, используемых в приложении

1. Данные о товаре
```
export interface IProduct {
    id: string;
    description: string;
    image: string;
    title: string;
    category: string;
    price: number;
}
```
2. Данные заказа
```
export interface IOrder {
    payment: TPayment;
    email: string;
    phone: string;
    address: string;
    total: number;
    items: string[];
}
```
3. Данные на карточке товара в галерее (кроме отображаемых данных карточка имеет id по которому идентифицируется товар)
```
export type TProductCard = Pick<IProduct, 'image' | 'title' | 'price' | 'category' | 'id'>
```
4. Данные о товаре в корзине
```
export type IOrderItem = Pick<IProduct, 'title' | 'price' | 'id'>
```
5. Тип отражающий варианты оплаты
```
type TPayment = 'online' | 'offline'
```
6. Данные о доставке товара (соответствуют данным модального окна)
```
export type TDeliveryInfo = Pick<IOrder, 'payment' | 'address'>
```
7. Данные о контактах покупателя (соответствуют данным модального окна)
```
export type TContactInfo = Pick<IOrder, 'phone' | 'email'>
```
8. Данные о пользователе
```
export type TUserInfo = TDeliveryInfo | TContactInfo
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- `View` - слой представления, отвечает за отображение данных на странице, 
- `Model` - слой данных, отвечает за хранение и изменение данных
- `Presenter` - презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - метод выполняет подписку на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие 

### Слой данных
Слой содержащий бизнес-логику приложения. Отвечает за работу с данными. При изменении данных генерируются события, улавливаемые другими частями приложения

#### Класс ProductList
Класс отвечает за хранение и поиск товаров. \
В полях класса содержится следующая информация:
- `_products: IProduct[];` - массив объектов товаров

Также класс предоставляет следующие методы для работы со списком товаров
- `getProduct(id: string): IProduct;` - возвращает товар по id
- сеттер и геттер для _products

#### Класс OrderList
Класс отвечает за хранение товаров, добавленных в корзину, и логику взаимодействий пользователей с ними \
Поля класса содержат следующие данные для этого:
- `_products: IProduct[];` - массив объектов товаров, добавленных в корзину
- `_total: number;` - общая цена товаров в корзине
- `events: IEvents;` - экземпляр класса `EventEmitter` для инициализации событий при работе с данными

Для работы с данными класс предоставляет следующие методы:
- `addProduct(product: IProduct): void;` - добавляет продукт в корзину
- `deleteProduct(product: IProduct): void;` - удаляет продукт из корзины
- `checkProductInOrder(id: string): boolean;` - проверяет наличие продукта в корзине
- `checkCorrectOrder(): boolean;` - проверяет возможность оформления заказа (нельзя оформить заказ, если корзина пустая, или в ней только 1 бесценный товар)

#### Класс User
Класс отвечает за хранение и работу с данными пользователя (покупателя) \
Для этого поля класса содержат следующие данные
- `payment: TPayment;` - выбранный тип платежа (онлайн или при получении)
- `address: string;` - адрес доставки
- `email: string;` - адрес электронной почты
- `phone: string;` - телефонный номер

Для работы с данными класс предоставляет следующий набор методов:
- `checkValidationContacts(data: Record<keyof TContactInfo, string>): boolean;` - проверяет валидность введенных данных `email` и `phone`
- `checkValidationDelivery(data: Record<keyof TDeliveryInfo, string>): boolean;` - проверяет валидность введенных данных `address`
- `getUserInfo(): TUserInfo;` - возвращает данные пользователя. Этот метод необходим также для установки данных пользователя, если он по какой то причине закрыл окно заполнения информации, а потом продолжил оформление заказа. Он позволит не заставлять пользователя вводить данные заново
- `setDeliveryInfo(data: TDeliveryInfo): void;` - 2 следующих метода записывают данные пользователя (отдельно данные по доставке, отдельно контакты)
- `setContactInfo(data: TContactInfo): void;`

### Слой отображения
Отвечает за интерфейс взаимодействия с пользователем. Генерирует события в ответ на действия пользователя. 

#### Класс Modal
Класс реализует модальное окно. Он предоставляет методы `open` и `close` для управления отображением модального окна. Также он устанавливает слушатели на клавиатуру для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.  
- `constructor(data: HTMLElement, events: IEvents, name: string)` Конструктор принимает элемент разметки, который будет размещен в контейнере модального окна, экземпляр класса `EventEmitter` для возможности инициации событий, а так же уникальное имя модального окна для генерации событий

Поля класса
- `modal: HTMLElement;` - элемент модального окна
- `name: string;` - уникальное название модального окна (необходимо для создания уникальных названий событий при открытии и закрытии формы):
    - basket - модальное окно с корзиной
    - card-preview - модальное окно с товаром
    - order -  модальное окно с информацией по доставке
    - contacts - модальное окно с информацией о контактах
    - success - модальное окно успешного заказа
- `events: IEvents;` - брокер событий

#### Класс Card
Класс объединяет общую функциональность отображения различных форматов карточек товаров на странице. Конструктор принимает элемент темплейта, который нужно заполнить данными и экземпляр класса `EventEmitter` для возможности инициации событий
Методы:
- `render(): HTMLElement;` - метод возвращает полностью заполненную карточку с установленными слушателями
- геттер id возвращает уникальный id карточки

#### Класс CardGallery
Класс расширяет класс Card и используется для отображения карточки в галерее на главной странице.  В классе устанавливается слушатель нажатия на карточку
Методы:
- `setData(cardData: TProductCard): void;` - заполняет атрибуты элементов карточки данными

#### Класс CardModal
Класс расширяет класс Card и используется для отображения карточки в модальном окне. В конструктор дополнительно устанавливается слушатель нажатия на кнопку
Методы:
- `setData(cardData: IProduct): void;` - заполняет атрибуты элементов карточки данными
- `setButtonName(name: string): void;` - меняет название на кнопке

#### Класс CardBasket
Класс расширяет класс Card и используется для отображения товара в корзине. В конструктор дополнительно передается номер товара в порядке их добавления в корзину и устанавливается слушатель нажатия на кнопку корзины рядом с товаром
Методы:
- `setData(cardData: TOrderItem): void;` - заполняет атрибуты элементов карточки данными

#### Класс CardsContainer
Отвечает за отображение блоков с карточками. В конструктор принимает HTMLElement контейнера, в котором должны размещаться карточки. Предоставляет следующие методы:
- `setItems<T>(data: T[]): void;` - для установки содержимого
- `cleanContainer(): void;` - для полного удаления содержимого контейнера

#### Класс Form
Отвечает за отображение формы и взаимодействие с ней пользователем

Поля класса:
- `submitButton: HTMLButtonElement;` - кнопка отправки формы
- `_form: HTMLFormElement;` - элемент формы
- `formName: string;` - значение атрибута name формы
- `inputs: NodeListOf<HTMLInputElement>;` - коллекция всех полей ввода формы
- `errors: Record<string, HTMLElement>` - объект хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов
- `events: IEvents` - экземпляр класса для `EventEmitter` для возможности инициации событий

Методы:
- `setValid(isValid: boolean): void;` - изменяет активность кнопки подтверждения
- `getInputValues(): Record<string, string>;` - возвращает объект с данными из полей формы, где ключ - name инпута, значение - данные введенные пользователем
- `setInputValues(data: Record<string, string>): void;` - принимает объект с данными для заполнения полей формы
- `setError(data: { field: string, value: string, validInformation: string }): void;` - принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода
- `showInputError (field: string, errorMessage: string): void;` - отображает полученный текст ошибки под указанным полем ввода
- `hideInputError (field: string): void;` - очищает текст ошибки под указанным полем ввода
- `cleanForm (): void;` - очистка полей ввода и деактивация кнопки отправки формы
- `get form: HTMLElement` - геттер для получения элемента формы

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Класс Presentor осуществляет взаимодействие компонентов\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в классе\
В `index.ts` сначала создаются экземпляры всех необходимых классов и констант для создания Presentor, а затем в классе настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*\
*События изменения данных (генерируются классами моделями данных)*
- `order:changed` - изменение состава корзины

*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*
- `basket:open` - открытие модального окна с корзиной
- `basket:delete` - удаление товара из корзины
- `basket:order` - начало оформление заказа

- `card-preview:open` - открытие модального окна с товаром
- `card-preview:add` - событие генерируется при нажатии на кнопку "Купить"

- `order:open` - открытие модального окна с формой информации о доставке
- `contacts:open` - открытие модального окна с формой информации о контактах
- `order:input` - изменение данных в форме с данными о доставке
- `contacts:input` - изменение данных в форме с контактными данными
- `order:submit` - сохранение данных о доставке
- `contacts:submit` - сохранение данных о контактах
- `order:validation` - необходимость валидации формы с данными о доставке
- `contacts:validation` - необходимость валидации формы с контактными данными

- `*:close` - закрытие любого модального окна